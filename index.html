<html>
<head>
	<script type="text/javascript" src="lib/execute_script.js"></script>
	<script type="text/javascript" src="lib/utilities.js"></script>
	<link rel='stylesheet' type="text/css" href="css/main.css">


</head>
<body>
	
	<div id="main">
		<canvas id="labels" class='fade-out'  width="300" height="300">Your Browser Doesn't Support Canvas</canvas>
		<div id="main_modal" class="fade-out size-down close">
			<div id="modal_content" class="fade-out size-down">
				<div id="info_left" class='fade-out size-down'></div>
				<div id="info_right" class='not-selected fade-out'>
					<div id='table_entry_info'></div>
					<div id='table_entry_img'></div>
				</div>
				<p class="close" onmousedown="javascript:CloseModal;">X</p>
			</div>
		</div>
		
	</div>
	



	<script type="text/javascript">
	
		//avoid image dragging
		document.body.ondragstart = function() { return false; };
		var label_timeout = 5000;
		var main = $('main');
		
		main.innerHTML += '<img usemap="#img_map" id="img_back" class="click" src="img/seignosse.jpg"/>';

		<!--//--><![CDATA[//><!--

			var images =  [
					{
						label_x: 1550, 
						label_y: 830, 
						label_pos_x: 70, 
						title: 'Projects', 
						file: new Image().src  = 'img/wave.png', 
						coords : [{x:0,y:860, _x:585, _y:1100},
								{x:650,y:860, _x:2500, _y:1100},
								{x:1550,y:750, _x:1650, _y:869}]
					}, //levre
					{
						label_x: 2000, 
						label_y: 1403, 
						label_pos_x: 70, 
						title: 'Blog', 
						file: new Image().src  = 'img/poto_droite.png', 
						coords : [{x:2100, y:1303, _x:2717, _y:1923},
									{x:2000,y:1303, _x:2220, _y:1465}]
					}, //poto droite
					{
						label_x: 420,
						label_y: 700,  
						label_pos_x: 70, 
						title: 'Artwork', 
						file: new Image().src  = 'img/poto_gauche.png', 
						coords :[{x:586, y:0, _x:642, _y:(1920)},
								{x:400,y:600, _x:585, _y:850}]
					}, //poto left
					{
						label_x: 1190, 
						label_y: 1230, 
						label_pos_x: 70, 
						title: 'Github', 
						file: new Image().src  = 'img/poto_centre.png', 
						coords : [{x:1330, y:1038, _x:(1365), _y:(1038 + 882)},
								{x:1180,y:1138, _x:1329, _y:1338}]
					},//poto centre
					{
						label_x: 1505,
						label_y: 1560, 
						label_pos_x: -70, 
						title: 'Contact', 
						file: new Image().src  = 'img/mouette.png', 
						coords : [{x:1390, y:1630, _x:1450, _y:1680},
									{x:1451,y:1430, _x:1602, _y:1680}]
					}
				]; //mouette
		
		//--><!]]>

		main.innerHTML += '<map id="img_map" name="img_map" >';
		
		var map = $("img_map");
		var h = (window.innerHeight / 1920);
		var w = (window.innerWidth / 2560);

		for( var i = 0; i < images.length; i++){
			map.innerHTML += "<img src='"+images[i].file+"' class='img fade-out' />";
			
			for(var j = 0; j < images[i].coords.length; j++){
				coords = images[i].coords[j];
				
				map.innerHTML += '<area id="img_'+i+'_'+j+'" shape="rect" class="area click" title="'+images[i].title+'" coords="'+
					Number(coords.x * w).toFixed(2)+','+
					Number(coords.y * h).toFixed(2)+','+
					Number(coords._x * w).toFixed(2)+','+
					Number(coords._y * h).toFixed(2)+'" />';
			}
		}
		main.innerHTML += ' </map> ';

		
		for(var i = 0; i < images.length; i++){
			for(var j in images[i].coords){
			
				img = $('img_'+i+'_'+j);
				img.onmousedown = onMouseClick;
				img.onmouseover =  onMouseOver;
			}
		}

		
		var ctx = getContext();
		ctx.globalAlpha = 1;

		document.onmousemove = onMouseMove;

		

		function Labels(alpha){

			var h = (window.innerHeight / 1920);
			var w = (window.innerWidth / 2560);

			
			ctx = getContext();
			clearContext(ctx);
			var x, y, image;
			for(var i = 0; i < images.length; i++){
				
				image = images[i];

				x = (image.label_x * w);
		
				y = (image.label_y * h);
		
				ctx.globalAlpha = alpha;
				ctx.font= "15px Georgia";
				ctx.fillStyle = "rgba(50,50,60,1)";
				ctx.strokeStyle= "rgba(50,50,60,1)";

				var txt_len =  ctx.measureText(image.title).width;				

				ctx.beginPath();
				ctx.moveTo(x, y);
				ctx.lineTo(x + txt_len, y );
				ctx.stroke();

				var new_x = x + txt_len;
				if(image.title === "Contact") new_x = x;

				ctx.moveTo(new_x, y);
				ctx.lineTo(new_x + (image.label_pos_x * w), y + 40 * h);
				ctx.stroke();

				ctx.beginPath();
				ctx.arc(new_x + (image.label_pos_x * w), y + 40 * h , 2, 0,2*Math.PI);
				ctx.stroke();	

				ctx.fillText(image.title, x  , y - (5 * h));

			}
		}

		window.onresize = function(){
			var h = (window.innerHeight / 1920);
			var w = (window.innerWidth / 2560);
			var coords, img;
			for( var i = 0; i < images.length; i++){
				for(var j = 0; j < images[i].coords.length; j++){
					img = $('img_'+i+'_'+j);
					coords = images[i].coords[j];
					
					img.coords = Number((coords.x * w).toFixed(2))+','+
						Number((coords.y * h).toFixed(2))+','+
						Number((coords._x * w).toFixed(2))+','+
						Number((coords._y * h).toFixed(2));
				}
			}

			Labels(1);
		}

		var timeout = null, activated = false;
		function onMouseMove(e){
			var label = $('labels');

			if(hasClass(label, 'fade-out')){
				removeClass(label, 'fade-out');
				addClass(label, 'fade-in');
				setTimeout(function(){
					removeClass(label, 'fade-in');
					addClass(label, 'fade-out');
				}, label_timeout);
			} else {
				clearTimeout(label);
			}
		}



		function onMouseOver(e){
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;	
			var s = prev(target,'img');

			if(!hasClass(s, 'fade-in')){
				addClass(s, 'fade-in');	
			}		

			target.onmouseout = target.onmouseleave =  function(e){
				fadeOut(s, 0);
			}
		}

		$('main_modal').onmousedown = $('main_modal').click = CloseModal;

		function CloseModal(e){
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;
				
			if(hasClass(target, 'close')){
				target = $('main_modal');
				fadeOut(target, 1000);
				sizeDown(target);
				
				target = $('modal_content');
				fadeOut(target);
				sizeDown(target);
				

				target = $('info_right');
				fadeOut(target);
				sizeDown(target);

				target = $('info_left');
				fadeOut(target);
				sizeDown(target);

				
				$('table_entry_img').innerHTML = $('table_entry_info').innerHTML = " ";
			};
			
		}

		function onMouseClick(e){
			e.preventDefault();
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;

			if(hasClass(target, 'click')){

				if(target.title === "Github"){
					window.open("https://github.com/amaurybrisou", "_blank", '', false);
					return;
				}
				if(target.title === "Blog"){
					window.open("http://puzzledge.org", "_blank", '', false);
					return;
				}
				
				var info_left = $("info_left");

				(function(callback){
					var ret = getPage(target.title.toLowerCase());
					callback(ret);
				}(function(data){
					info_left.innerHTML = data;
					
					exec_body_scripts(info_left);
					show($('main_modal'));

				}));
			}
		}

		function show(main_modal){
			fadeIn(main_modal);
			sizeIn(main_modal);
			var modal_content = $('modal_content');
			fadeIn(modal_content);
			sizeIn(modal_content);			
		}

		var getPage = function(t){
			var xhr = new XMLHttpRequest(), ret = "";
			xhr.open('GET', 'views/'+t+'.html', false);
			xhr.onreadystatechange= function() {
			    if (this.readyState!==4) return;
			    if (this.status!==200) return; // or whatever error handling you want
			    ret = this.responseText;
			};
			xhr.send();
			return ret;
			
		}

		
		
		Labels(1);

		
		</script>
	
</body>
</html>