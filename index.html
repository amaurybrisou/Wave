<html>
<head>
</head>
<body>
	
	<div id="main">
		<div id="modal"></div>
		<canvas id="labels"></canvas>
	</div>
	


	<style media="screen" type="text/css">

	

	* {		
		margin: 0;
	}


	#modal {
		height:1%;
		width:1%;
		background-color: rgba(70,95,91,1);
		z-index: 3000;
		position: fixed;
		visibility: hidden;
	}

	#modal_content {
		visibility: hidden;
		opacity: 0.85;
		height:0%;
		width:0%; 
		z-index: 4000;
		position:fixed;
		left: 10%;
		top: 10%;
		background-color : rgba(161,166,172,1);
		-moz-border-radius:10px 10px 10px 10px;
		-webkit-border-radius:10px 10px 10px 10px;
		border-radius:10px 10px 10px 10px;
	}

	
	#labels {
		height: 100%;
		width: 100%;		
		z-index: 2000;
		pointer-events: none;
		position: absolute;
	}

	#img_back{
		position: fixed;
		height: 100%;
		width: 100%;
	}

	.img {
		visibility:hidden;
		position: absolute;
		height: 100%;
		width: 100%;
		z-index:1000; 
		pointer-events:none;
		
	}

	.area:hover {
		cursor: pointer;
	}

	.close {
		height: 10px;
		width: 10px;
		float:right;
	}
	
	</style>

	<script type="text/javascript">
		var main = $('main');
		var MAX_FOG = 0.6;
		
		main.innerHTML += '<img usemap="#img_map" id="img_back" class="click" src="img/seignosse.jpg" />';

		<!--//--><![CDATA[//><!--

			var images =  [
					{
						label_x: 1550, 
						label_y: 830, 
						label_pos_x: 70, 
						title: 'Projets', 
						file: new Image().src  = 'img/wave.png', 
						coords : [{x:0,y:860, _x:585, _y:1100},
								{x:650,y:860, _x:2500, _y:1100},
								{x:1550,y:750, _x:1650, _y:869}]
					}, //levre
					{
						label_x: 2000, 
						label_y: 1403, 
						label_pos_x: 70, 
						title: 'Blog', 
						file: new Image().src  = 'img/poto_droite.png', 
						coords : [{x:2100, y:1303, _x:2717, _y:1923},
									{x:2000,y:1303, _x:2120, _y:1465}]
					}, //poto droite
					{
						label_x: 420,
						label_y: 700,  
						label_pos_x: 70, 
						title: 'Maquette', 
						file: new Image().src  = 'img/poto_gauche.png', 
						coords :[{x:586, y:0, _x:642, _y:(1920)},
								{x:400,y:600, _x:585, _y:850}]
					}, //poto left
					{
						label_x: 1190, 
						label_y: 1230, 
						label_pos_x: 70, 
						title: 'Github', 
						file: new Image().src  = 'img/poto_centre.png', 
						coords : [{x:1330, y:1038, _x:(1365), _y:(1038 + 882)},
								{x:1180,y:1138, _x:1329, _y:1338}]
					},//poto centre
					{
						label_x: 1505,
						label_y: 1560, 
						label_pos_x: -70, 
						title: 'Contact', 
						file: new Image().src  = 'img/mouette.png', 
						coords : [{x:1390, y:1630, _x:1450, _y:1680},
									{x:1451,y:1430, _x:1602, _y:1680}]
					}
				]; //mouette
		
		//--><!]]>

		main.innerHTML += '<map id="img_map" name="img_map" >';
		
		var map = $("img_map");
		var h = (window.innerHeight / 1920);
		var w = (window.innerWidth / 2560);

		for( var i = 0; i < images.length; i++){
			map.innerHTML += "<img src='"+images[i].file+"' class='img' />";
			
			for(var j = 0; j < images[i].coords.length; j++){
				coords = images[i].coords[j];
				
				map.innerHTML += '<area id="img_'+i+'_'+j+'" shape="rect" class="area click" title="'+images[i].title+'" coords="'+
					Number(coords.x * w).toFixed(2)+','+
					Number(coords.y * h).toFixed(2)+','+
					Number(coords._x * w).toFixed(2)+','+
					Number(coords._y * h).toFixed(2)+'" />';
			}
		}
		main.innerHTML += ' </map> ';

		

		for(var i = 0; i < images.length; i++){
			
			for(var j in images[i].coords){
				img = $('img_'+i+'_'+j);
				img.onmousedown = onMouseClick;
				img.onmouseover =  onMouseOver;
			}
		}

		
		CanvasRenderingContext2D.prototype.clear = 
		  CanvasRenderingContext2D.prototype.clear || function (preserveTransform) {
		    if (preserveTransform) {
		      this.save();
		      this.setTransform(1, 0, 0, 1, 0, 0);
		    }

		    this.clearRect(0, 0, this.canvas.width, this.canvas.height);

		    if (preserveTransform) {
		      this.restore();
		    }           
		};
		

		var ctx = getContext();
		ctx.globalAlpha = 1;

		document.onmousemove = onMouseMove;

		function getContext(){
			return (function(callback){
				$("labels").setAttribute("width", (window.innerWidth)+'px');
				$("labels").setAttribute("height", (window.innerHeight) +'px');
				return callback();
			}(function(){
				return $("labels").getContext("2d");
			}));
		}
		function Labels(alpha){

			var h = (window.innerHeight / 1920);
			var w = (window.innerWidth / 2560);

			
			ctx = getContext();
			ctx.clear();
			var x, y, image;
			for(var i = 0; i < images.length; i++){
				
				image = images[i];

				x = (image.label_x * w);
		
				y = (image.label_y * h);
		
				ctx.globalAlpha = alpha;
				ctx.font= "15px Georgia";
				ctx.fillStyle = "rgba(50,50,60,1)";
				ctx.strokeStyle= "rgba(50,50,60,1)";

				var txt_len =  ctx.measureText(image.title).width;				

				ctx.beginPath();
				ctx.moveTo(x, y);
				ctx.lineTo(x + txt_len, y );
				ctx.stroke();

				var new_x = x + txt_len;
				if(image.title === "Contact") new_x = x;

				ctx.moveTo(new_x, y);
				ctx.lineTo(new_x + (image.label_pos_x * w), y + 40 * h);
				ctx.stroke();

				ctx.beginPath();
				ctx.arc(new_x + (image.label_pos_x * w), y + 40 * h , 2, 0,2*Math.PI);
				ctx.stroke();	

				ctx.fillText(image.title, x  , y - (5 * h));

			}

			

		}

		window.onresize = function(){
			var h = (window.innerHeight / 1920);
			var w = (window.innerWidth / 2560);
			var coords, img;
			for( var i = 0; i < images.length; i++){
				for(var j = 0; j < images[i].coords.length; j++){
					img = $('img_'+i+'_'+j);
					coords = images[i].coords[j];
					
					img.coords = Number((coords.x * w).toFixed(2))+','+
						Number((coords.y * h).toFixed(2))+','+
						Number((coords._x * w).toFixed(2))+','+
						Number((coords._y * h).toFixed(2));
				}
			}

			Labels(1);
		}

		var timeout = null, activated = false;
		function onMouseMove(e){
			var label = $('labels');

			
			return (function(){
				if(timeout !== null){
					clearTimeout(timeout);
					if(!activated){
						fadeIn(0);
					}
				} else {
					if(activated) return;
					activated = true;
					fadeIn(0);
				}

				function fadeIn(alpha){
					if(alpha < 1){
						Labels(alpha);
						alpha += 0.1
						setTimeout(function(){ fadeIn(alpha); }, 50);
					} 
				};

				timeout = setTimeout(function(){
					timeout = null;
					fadeOut(1);
					function fadeOut(alpha){
						if(alpha > 0){
							Labels(alpha);
							alpha -= 0.1;
							setTimeout(function(){ fadeOut(alpha); }, 100);
						} else {
							activated = false;
						}
						
					};
				}, 3000);
			}());
		}

		function onMouseOver(e){
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;	
			var s = target.prev('img');

			target.onmouseout = function(e){
				target.prev('img').style.visibility = 'hidden';	
			}

			target.prev('img').style.visibility = 'visible';	

			
		}

		$('modal').onmousedown = function(e){
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;	
			
			if(target.id === "modal") $('modal').hide();
			
		}

		function onMouseClick(e){
			if (e == null) e = window.event;
			var target = e.target != null ? e.target : e.srcElement;

			if(target.className.contains('click')){
				
				var modal = $("modal");

				(function(callback){
					var ret = getPage(target.title.toLowerCase());
					callback(ret);
				}(function(data){
	
					modal.innerHTML = '<div id="modal_content" >'+
					'<p class="close" onmousedown="javascript:$(\'modal\').hide();">X</p>'+
					data+'</div>';

					modal.show();

				}));
			}
		}

		var getPage = function(t){
			var xhr = new XMLHttpRequest(), ret = "";
			xhr.open('GET', 'save/'+t+'.html', false);
			xhr.onreadystatechange= function() {
			    if (this.readyState!==4) return;
			    if (this.status!==200) return; // or whatever error handling you want
			    ret = this.responseText;
			};
			xhr.send();
			return ret;
			
		}

		Object.prototype.show = function(){
			var that = this;
			return (function(){
				that.firstChild.style.opacity = 0;
				that.style.visibility = 'visible';
				that.firstChild.style.visibility = 'visible';

				var i = j = 0;
					
				grow();
				
				function grow(){
					var height =  (that.style.height === "" ) ? 0 : parseInt(that.style.height);
					var width =   (that.style.width === "" ) ? 0 : parseInt(that.style.width);
					var child_height =  (that.firstChild.style.height === "" ) ? 0 : parseInt(that.firstChild.style.height);
					var child_width =   (that.firstChild.style.width === "" ) ? 0 : parseInt(that.firstChild.style.width);
					setTimeout(function(){
						that.style.height = height + 1+'%';
						that.style.width = width + 1+'%';


						if(height + 1 <= 120){
							if((height % 16) === 0 && i < MAX_FOG){
								that.style.background = 'rgba(70,95,91, '+i+')';
								//that.style.opacity = i;
								i += 0.1;
							}
							if(height >= 10 && j < 0.9){
						
								that.firstChild.style.opacity = j;
								//that.firstChild.style['background'] = 'rgba(161,166,172, '+j+')';
								j += 0.1;
							}
							if(height >= 10 ){
								if(child_width <= 80){
									that.firstChild.style.width = child_width + 1+'%';	
								}
								if(child_height <= 80){
									that.firstChild.style.height = child_height + 1+'%';
								}								
							}
							
							
							grow();
						}
					}, 1);
				}
			}());
		}

		Object.prototype.hide = function(){
			var that = this;

			return (function(){
				dec();
				var i = MAX_FOG;
				var j = 1;
				function dec(){
					setTimeout(function(){
						that.style.background = 'rgba(70,95,91, '+i+')';
						//that.style.opacity = i;
						i -= 0.1;

						j -= 0.1;
						that.firstChild.style.opacity = j;
						//that.firstChild.style['background'] = 'rgba(161,166,172, '+j+')';
								
						if(i > 0 || j > 0){
							dec();
						} else {
							that.style.visibility = 'hidden';
							that.firstChild.style.visibility = 'hidden';
							that.style.height = '0%';
							that.style.width =  '0%';
							that.firstChild.style.height = '0%';
							that.firstChild.style.width = '0%';
						}
					}, 20);
				}
				
			}());	
		}

		String.prototype.contains = function(s){
			return (this.indexOf(s) != -1) ? 1 : 0;
		}

		Object.prototype.prev = function(s){
			var that = this;
			
			if( that.previousSibling.className.contains(s)){
				return that.previousSibling;
			}

			that = that.previousSibling;
			return that.prev(s);
		
			
		}

		function $(id) { return document.getElementById(id); }


		//onMouseMove();
		Labels(1);

		
		</script>
	
</body>
</html>